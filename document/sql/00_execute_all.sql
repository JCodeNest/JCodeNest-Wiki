-- =============================================
-- JCodeNest-Wiki 数据库完整执行脚本
-- 版本: 1.0.0
-- 创建时间: 2025-07-23
-- 描述: 按顺序执行所有SQL脚本
-- =============================================

-- 设置字符集
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- =============================================
-- 执行顺序说明
-- =============================================
/*
1. 01_database_init.sql     - 数据库初始化
2. 02_user_tables.sql       - 用户管理模块表
3. 03_content_tables.sql    - 内容管理模块表
4. 04_payment_tables.sql    - 支付交易模块表
5. 05_learning_tables.sql   - 学习管理模块表
6. 06_social_tables.sql     - 社交互动模块表
7. 07_file_system_tables.sql - 文件和系统管理模块表
8. 08_init_data.sql         - 初始化数据
9. 09_indexes.sql           - 索引优化
*/

-- =============================================
-- 1. 数据库初始化
-- =============================================
SOURCE 01_database_init.sql;

-- =============================================
-- 2. 用户管理模块表结构
-- =============================================
SOURCE 02_user_tables.sql;

-- =============================================
-- 3. 内容管理模块表结构
-- =============================================
SOURCE 03_content_tables.sql;

-- =============================================
-- 4. 支付交易模块表结构
-- =============================================
SOURCE 04_payment_tables.sql;

-- =============================================
-- 5. 学习管理模块表结构
-- =============================================
SOURCE 05_learning_tables.sql;

-- =============================================
-- 6. 社交互动模块表结构
-- =============================================
SOURCE 06_social_tables.sql;

-- =============================================
-- 7. 文件和系统管理模块表结构
-- =============================================
SOURCE 07_file_system_tables.sql;

-- =============================================
-- 8. 初始化数据
-- =============================================
SOURCE 08_init_data.sql;

-- =============================================
-- 9. 索引优化
-- =============================================
SOURCE 09_indexes.sql;

-- 恢复外键检查
SET FOREIGN_KEY_CHECKS = 1;

-- =============================================
-- 执行完成统计
-- =============================================
SELECT 
    '数据库初始化完成' as status,
    DATABASE() as database_name,
    (SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = DATABASE()) as total_tables,
    (SELECT COUNT(*) FROM information_schema.columns WHERE table_schema = DATABASE()) as total_columns,
    (SELECT COUNT(*) FROM information_schema.statistics WHERE table_schema = DATABASE()) as total_indexes,
    NOW() as completion_time;

-- =============================================
-- 表统计信息
-- =============================================
SELECT 
    table_name as '表名',
    table_comment as '表注释',
    table_rows as '预估行数',
    ROUND(((data_length + index_length) / 1024 / 1024), 2) as '大小(MB)'
FROM information_schema.tables 
WHERE table_schema = DATABASE()
ORDER BY table_name;

-- =============================================
-- 使用说明
-- =============================================
/*
使用方法：
1. 确保MySQL服务正在运行
2. 使用root用户或具有创建数据库权限的用户登录MySQL
3. 在MySQL命令行中执行：source /path/to/00_execute_all.sql
4. 或者使用MySQL客户端工具导入此脚本

注意事项：
1. 执行前请确保没有同名数据库，或者备份现有数据
2. 建议在测试环境先执行验证
3. 生产环境使用前请根据实际情况调整配置参数
4. 索引创建可能需要一些时间，请耐心等待

数据库设计特点：
1. 使用utf8mb4字符集，支持emoji和特殊字符
2. 所有表都有完整的中文注释
3. 采用雪花算法ID作为主键
4. 使用逻辑外键，不设置物理外键约束
5. 支持软删除机制
6. 标准化的时间字段设计
7. 合理的索引设计，优化查询性能

表结构概览：
- 用户管理模块：8张表（usr_前缀）
- 内容管理模块：8张表（cnt_前缀）
- 支付交易模块：8张表（pay_前缀）
- 学习管理模块：7张表（lrn_前缀）
- 社交互动模块：8张表（soc_前缀）
- 文件管理模块：2张表（fil_前缀）
- 系统管理模块：4张表（sys_前缀）

总计：45张表，覆盖JCodeNest-Wiki项目的所有核心业务功能
*/
